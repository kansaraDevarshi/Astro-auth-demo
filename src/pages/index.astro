---
import { getSession } from 'auth-astro/server';
import Layout from '../layouts/Layout.astro';

const session = await getSession(Astro.request);
const isAuthenticated = session && session.user;
---

<Layout title='Signin/Signup'>
  <main>
    <h1>
      {
        isAuthenticated
          ? `Hi ${session?.user?.name ?? ''}`
          : 'You are not logged in !'
      }
    </h1>

    {
      !isAuthenticated ? (
        <>
          <button id='login'>Login With Github</button>
          <button id='login-with-google'>Login With Google</button>
        </>
      ) : (
        <>
          <h2>Go to <a href="/dashboard/">dashboard</a></h2>
          <button id='logout'>Logout</button>
        </>
      )
    }

    <!-- {
      data?.users.map((item: any) => (
        <ul>
          <li>{item.name}</li>
        </ul>
      ))
    } -->

    <script>
      const { signIn, signOut } = await import('auth-astro/client');
      if (typeof sessionStorage !== 'undefined') {
        const loginButton = document.querySelector(
          '#login-with-google'
        ) as HTMLButtonElement | null;
        const loginGitButton = document.querySelector(
          '#login'
        ) as HTMLButtonElement | null;
        const logoutButton = document.querySelector(
          '#logout'
        ) as HTMLButtonElement | null;

        if (loginButton && loginGitButton) {
          loginButton.onclick = () => signIn('google');
          loginGitButton.onclick = () => signIn('github');
        }

        if (logoutButton) {
          logoutButton.onclick = () => signOut();
        }
      }
    </script>
  </main>
</Layout>
